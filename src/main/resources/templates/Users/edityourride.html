<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>Edit Your Ride</title>
	<script src="//static.filestackapi.com/filestack-js/3.x.x/filestack.min.js"></script>
	<script src="//static.filestackapi.com/filestack-drag-and-drop-js/3.x.x/filestack-drag-and-drop.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
	      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
	<link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<div th:replace="/partials/navbar :: navbar"></div>
<div>
	<form th:action="@{/car/{id}/edit(id=${car.id})}" method="post" th:object="${car}">
		<h3><label for="make">Car Make</label><br></h3>
		<input type="text" id="make" th:field="*{make}"/><br>

		<h3><label for="model">Car Model</label><br></h3>
		<input type="text" id="model" th:field="*{model}"/><br>

		<h3><label for="year">Year</label><br></h3>
		<input type="text" id="year" th:field="*{year}"/><br>

		<h3><label for="mileage">Mileage</label><br></h3>
		<input type="text" id="mileage" th:field="*{mileage}"/><br>

		<h3><label for="price">Daily Price</label><br></h3>
		<input type="text" id="price" th:field="*{pricePerDay}"/><br>

		<h3><label for="location">Zip code</label><br></h3>
		<input type="text" id="location" th:field="*{carLocationZip}"/><br>

		<label for="is_available">Is your ride available?</label>
		<select id="is_available" th:field="*{available}">
			<option value="true">Yes</option>
			<option value="false">No</option>
		</select>

		<button type="submit">List Ride</button>
	</form>
	<div th:if="${car.photos != null && !car.photos.isEmpty()}">
		<div th:each="photo : ${car.photos}">
			<div th:if="${!photo.carPhotoURL.isEmpty()}">
				<form th:action="@{/deleteImg/{id}(id=${photo.id})}" th:method="post">
					<input type="hidden" th:value="${car.id}" name="carid">
					<img th:src="${photo.getCarPhotoURL()}"
					     style="max-width: 100px;"
					     alt="car photo">
					<button type="submit">delete</button>
				</form>
			</div>
		</div>
	</div>
	<form th:action="@{/car/{id}/addPhoto(id=${car.id})}" th:method="post">
		<input type="hidden" class="hiddenInput"
		       th:field="${newPhoto}" value=""/>
		<div id="thumbnailContainer"></div>
		<button id="filepicker">Upload Image</button>
		<button type="submit">Save Image</button>
	</form>
</div>


<form th:action="@{/car/{id}/delete(id=${car.id})}" method="post">
	<button type="submit">Delete</button>
</form>
<div th:replace="/partials/footer :: footer"></div>

<script th:src="'//static.filestackapi.com/filestack-js/3.x.x/filestack.min.js'"></script>
<script th:inline="javascript">
	var client = filestack.init([[${@environment.getProperty('fileStackKey')}]]);
	document.getElementById('filepicker').addEventListener('click', function (e) {
		e.preventDefault();
		var options = {
			maxFiles: 1,
			onUploadDone: function (response) {
				const formContainer = document.querySelector(".formContainer")
				const hiddenInputs = formContainer.querySelectorAll('.hiddenInput')
				console.log(formContainer);
				console.log(hiddenInputs);
				if (response.filesUploaded[i] != null) {
					hiddenInputs[i].value = response.filesUploaded[i].url;
					const thumbnail = document.createElement('img');
					thumbnail.src = response.filesUploaded[i].url;
					thumbnail.style.maxWidth = '100px';
					thumbnailContainer.appendChild(thumbnail);
				} else {
					element.value = "";
				}

				document.getElementById('submit-button');
				console.log(response.filesUploaded);
			}
		};
		var picker = client.picker(options);
		picker.open();
	});

</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</body>
</html>