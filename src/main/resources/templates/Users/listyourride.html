<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
	<title>List Your Ride</title>
    <script src="//static.filestackapi.com/filestack-js/3.x.x/filestack.min.js"></script>
    <script src="//static.filestackapi.com/filestack-drag-and-drop-js/3.x.x/filestack-drag-and-drop.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<div th:replace="~{partials/navbar :: navbar}"></div>
<div>
    <form class="formContainer" th:action="@{/listyourride}" method="post" th:object="${carForm}">
        <h3><label for="make">Car Make</label><br></h3>
        <input type="text" id="make" th:field="*{make}"/><br>

        <h3><label for="model">Car Model</label><br></h3>
        <input type="text" id="model" th:field="*{model}"/><br>

        <h3><label for="year">Year</label><br></h3>
        <input type="number" id="year" th:field="*{year}"/><br>

        <h3><label for="mileage">Mileage</label><br></h3>
        <input type="number" id="mileage" th:field="*{mileage}"/><br>

        <h3><label for="price">Daily Price</label><br></h3>
        <input type="number" id="price" th:field="*{pricePerDay}"/><br>

        <h3><label for="locationCity">City</label><br></h3>
        <input type="text" id="locationCity" th:field="*{carLocationCity}"/><br>

        <h3><label for="location">Zip code</label><br></h3>
        <input type="number" id="location" th:field="*{carLocationZip}"/><br><br>

        <label for="is_available">Is your ride available?</label>
        <select id="is_available" th:field="*{available}">
            <option value="true">Yes</option>
            <option value="false">No</option>
        </select><br><br>

<!--        <input type="hidden" class="carPhotoURL" name="carPhotoURL">-->

        <input type="hidden" class="hiddenInput"
               th:field="*{carPhotoURL[0]}" value=""/>
        <input type="hidden" class="hiddenInput"
               th:field="*{carPhotoURL[1]}" value=""/>
        <input type="hidden" class="hiddenInput"
               th:field="*{carPhotoURL[2]}" value=""/>
        <input type="hidden" class="hiddenInput"
               th:field="*{carPhotoURL[3]}" value=""/>
<!--        <input type="hidden" class="carPhotoURL" name="carPhotoURL[]" th:field="*{carPhotoURL[0]}">-->
        <button id="filepicker">Upload Image</button><br><br>



        <!--       <input type="hidden" id="carPhotoURL1" name="carPhotoURL1" th:field="*{carPhotoURL1}">-->
<!--        <button id="filepicker1">Upload Image</button><br><br>-->

<!--       <input type="hidden" id="carPhotoURL2" name="carPhotoURL2" th:field="*{carPhotoURL2}">-->
<!--        <button id="filepicker2">Upload Image</button><br><br>-->

<!--       <input type="hidden" id="carPhotoURL3" name="carPhotoURL3" th:field="*{carPhotoURL3}">-->
<!--        <button id="filepicker3">Upload Image</button><br><br>-->

        <button type="submit">List Ride</button>
    </form>

    <script th:src="'//static.filestackapi.com/filestack-js/3.x.x/filestack.min.js'"></script>
    <script th:inline="javascript">
        var client = filestack.init([[${@environment.getProperty('fileStackKey')}]]);
        document.getElementById('filepicker').addEventListener('click', function(e) {
            e.preventDefault();
            var options = {
                maxFiles: 3,
                onUploadDone: function(response) {
                    const formContainer = document.querySelector(".formContainer")
                    const hiddenInputs = formContainer.querySelectorAll('.hiddenInput')
                    console.log(formContainer);
                    console.log(hiddenInputs);
                    // let inputElements = document.getElementById('carPhotoURL');
                  for(let i = 0; i < hiddenInputs.length; i++){
                      if(response.filesUploaded[i] != null) {
                          hiddenInputs[i].value = response.filesUploaded[i].url;
                      }
                          // if (imageObj.url != null) {
                          //     element.value = imageObj?.url;
                          //     console.log(element);
                          //     console.log(url);
                          //     break;
                          // }
                          else {
                              element.value = "";
                          }
                      }

                  //   for(element of hiddenInputs){
                  //       console.log(element);
                  //   }
                    document.getElementById('submit-button');
                    console.log(response.filesUploaded);
                }
            };
            var picker = client.picker(options);
            picker.open();
        });

    </script>
</div>
<div th:replace="/partials/footer :: footer"></div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script th:src="@{/js/scripts.js}"></script>
</body>
</html>