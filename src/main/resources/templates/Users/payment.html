<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Checkout</title>
	<script src="https://sandbox.web.squarecdn.com/v1/square.js"></script>
</head>
<body>
<div id="payment-form">
	<div id="payment-status-container"></div>
	<div id="card-container"></div>
	<button id="card-button" type="button">Pay</button>
</div>
<script type="module">
	const squareUser = "[[${squareUser}]]";
	const squareKey = "[[${squareKey}]]";
	const payments = Square.payments(squareUser, 'main');
	const card = await payments.card();
	await card.attach('#card-container');

	const cardButton = document.getElementById('card-button');
	cardButton.addEventListener('click', async () => {
		const statusContainer = document.getElementById('payment-status-container');

		try {
			const result = await card.tokenize();
			if (result.status === 'OK') {
				console.log(`Payment token is ${result.token}`);
				statusContainer.innerHTML = "Payment Successful";
			} else {
				let errorMessage = `Tokenization failed with status: ${result.status}`;
				if (result.errors) {
					errorMessage += ` and errors: ${JSON.stringify(
							result.errors
					)}`;
				}

				throw new Error(errorMessage);
			}
		} catch (e) {
			console.error(e);
			statusContainer.innerHTML = "Payment Failed";
		}
	});
</script>
</body>
</html>